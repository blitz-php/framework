var blitzphpDebugBar={toolbarContainer:null,toolbar:null,icon:null,init:function(){this.toolbarContainer=document.getElementById("toolbarContainer"),this.toolbar=document.getElementById("debug-bar"),this.icon=document.getElementById("debug-icon"),blitzphpDebugBar.createListeners(),blitzphpDebugBar.setToolbarState(),blitzphpDebugBar.setToolbarPosition(),blitzphpDebugBar.setToolbarTheme(),blitzphpDebugBar.toggleViewsHints(),blitzphpDebugBar.routerLink(),blitzphpDebugBar.setHotReloadState(),document.getElementById("debug-bar-link").addEventListener("click",blitzphpDebugBar.toggleToolbar,!0),document.getElementById("debug-icon-link").addEventListener("click",blitzphpDebugBar.toggleToolbar,!0);var e=this.toolbar.querySelector('button[data-time="'+localStorage.getItem("debugbar-time")+'"]');blitzphpDebugBar.addClass(e.parentNode.parentNode,"current"),historyLoad=this.toolbar.getElementsByClassName("blitzphp-history-load");for(var t=0;t<historyLoad.length;t++)historyLoad[t].addEventListener("click",(function(){loadDoc(this.getAttribute("data-time"))}),!0);var a=blitzphpDebugBar.readCookie("debug-bar-tab");if(document.getElementById(a)){var r=document.getElementById(a);blitzphpDebugBar.switchClass(r,"debug-bar-ndisplay","debug-bar-dblock"),blitzphpDebugBar.addClass(r,"active"),(a=document.querySelector("[data-tab="+a+"]"))&&blitzphpDebugBar.addClass(a.parentNode,"active")}},createListeners:function(){for(var e=[].slice.call(this.toolbar.querySelectorAll(".blitzphp-label a")),t=0;t<e.length;t++)e[t].addEventListener("click",blitzphpDebugBar.showTab,!0);var a=this.toolbar.querySelectorAll("[data-toggle]");for(t=0;t<a.length;t++){let e=a[t].getAttribute("data-toggle");if("datatable"===e){let e=a[t].getAttribute("data-table");a[t].addEventListener("click",(function(){blitzphpDebugBar.toggleDataTable(e)}),!0)}else if("childrows"===e){let e=a[t].getAttribute("data-child");a[t].addEventListener("click",(function(){blitzphpDebugBar.toggleChildRows(e)}),!0)}else a[t].addEventListener("click",blitzphpDebugBar.toggleRows,!0)}},showTab:function(){var e=document.getElementById(this.getAttribute("data-tab"));if(e){blitzphpDebugBar.createCookie("debug-bar-tab","",-1);for(var t=e.classList.contains("debug-bar-dblock"),a=document.querySelectorAll("#debug-bar .tab"),r=0;r<a.length;r++)blitzphpDebugBar.switchClass(a[r],"debug-bar-dblock","debug-bar-ndisplay");var i=document.querySelectorAll("#debug-bar .blitzphp-label");for(r=0;r<i.length;r++)blitzphpDebugBar.removeClass(i[r],"active");t||(blitzphpDebugBar.switchClass(e,"debug-bar-ndisplay","debug-bar-dblock"),blitzphpDebugBar.addClass(this.parentNode,"active"),blitzphpDebugBar.createCookie("debug-bar-tab",this.getAttribute("data-tab"),365))}},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},switchClass:function(e,t,a){blitzphpDebugBar.removeClass(e,t),blitzphpDebugBar.addClass(e,a)},toggleRows:function(e){if(e.target){let t=e.target.closest("tr"),a=document.getElementById(t.getAttribute("data-toggle"));a.classList.contains("debug-bar-ndisplay")?blitzphpDebugBar.switchClass(a,"debug-bar-ndisplay","debug-bar-dtableRow"):blitzphpDebugBar.switchClass(a,"debug-bar-dtableRow","debug-bar-ndisplay")}},toggleDataTable:function(e){"string"==typeof e&&(e=document.getElementById(e+"_table")),e&&(e.classList.contains("debug-bar-ndisplay")?blitzphpDebugBar.switchClass(e,"debug-bar-ndisplay","debug-bar-dblock"):blitzphpDebugBar.switchClass(e,"debug-bar-dblock","debug-bar-ndisplay"))},toggleChildRows:function(e){"string"==typeof e&&(par=document.getElementById(e+"_parent"),e=document.getElementById(e+"_children")),par&&e&&(e.classList.contains("debug-bar-ndisplay")?blitzphpDebugBar.removeClass(e,"debug-bar-ndisplay"):blitzphpDebugBar.addClass(e,"debug-bar-ndisplay"),par.classList.toggle("timeline-parent-open"))},toggleToolbar:function(){var e=!blitzphpDebugBar.toolbar.classList.contains("debug-bar-ndisplay");e?(blitzphpDebugBar.switchClass(blitzphpDebugBar.icon,"debug-bar-ndisplay","debug-bar-dinlineBlock"),blitzphpDebugBar.switchClass(blitzphpDebugBar.toolbar,"debug-bar-dinlineBlock","debug-bar-ndisplay")):(blitzphpDebugBar.switchClass(blitzphpDebugBar.icon,"debug-bar-dinlineBlock","debug-bar-ndisplay"),blitzphpDebugBar.switchClass(blitzphpDebugBar.toolbar,"debug-bar-ndisplay","debug-bar-dinlineBlock")),blitzphpDebugBar.createCookie("debug-bar-state","",-1),blitzphpDebugBar.createCookie("debug-bar-state",1==e?"minimized":"open",365)},setToolbarState:function(){"open"!=blitzphpDebugBar.readCookie("debug-bar-state")?(blitzphpDebugBar.switchClass(blitzphpDebugBar.icon,"debug-bar-ndisplay","debug-bar-dinlineBlock"),blitzphpDebugBar.switchClass(blitzphpDebugBar.toolbar,"debug-bar-dinlineBlock","debug-bar-ndisplay")):(blitzphpDebugBar.switchClass(blitzphpDebugBar.icon,"debug-bar-dinlineBlock","debug-bar-ndisplay"),blitzphpDebugBar.switchClass(blitzphpDebugBar.toolbar,"debug-bar-ndisplay","debug-bar-dinlineBlock"))},toggleViewsHints:function(){if(localStorage.getItem("debugbar-time")!=localStorage.getItem("debugbar-time-new"))return void(document.querySelector('a[data-tab="blitzphp-views"]').href="#");var e=[],t=[],a=function(e,t){return null===e.parentNode?null:e.parentNode!==t?a(e.parentNode,t):e};const r=["NOSCRIPT","SCRIPT","STYLE"],i=["HTML","BODY","HEAD"];var l=function(e,t){if(-1!==i.indexOf(e.nodeName)){for(var a=0;a<document.body.children.length;++a){var l=t?document.body.children.length-(a+1):a,o=document.body.children[l];if(-1===r.indexOf(o.nodeName))return[o,t]}return null}for(;null!==e&&-1!==r.indexOf(e.nodeName);)e=t?e.previousElementSibling:e.nextElementSibling;return null===e?null:[e,t]},o=function(e){if(e){if(null!==e.nextElementSibling)return l(e.nextElementSibling,!1)||l(e.previousElementSibling,!0);if(null!==e.previousElementSibling)return l(e.previousElementSibling,!0)}return null};function b(){for(var i in t=function(){for(var e=[],t=[],a=document.evaluate("//comment()[starts-with(., ' DEBUG-VIEW')]",document,null,XPathResult.ANY_TYPE,null),r=a.iterateNext();r;)e.push(r),r=a.iterateNext();for(var i=0;i<e.length;++i){var l=e[i].nodeValue.substring(18,e[i].nodeValue.length-1);"S"===e[i].nodeValue[12]?t[l]=[e[i],null]:t[l]&&(t[l][1]=e[i])}return t}(),t){var l=o(t[i][0]),b=o(t[i][1]);if(null!==l&&null!==b){var d=a(b[0],l[0].parentNode);if(null===d){if(null===(d=a(l[0],b[0].parentNode)))continue;l[0]=d}else b[0]=d;var u,p,s=document.createElement("div"),g=document.createElement("div"),c=l[0].parentNode.childNodes,h=l[0].parentNode;s.classList.add("debug-view"),s.classList.add("show-view"),g.classList.add("debug-view-path"),g.innerText=i,s.appendChild(g);for(var B=0;B<c.length;++B)if(c[B]===t[i][1]||c[B]===t[i][0]||c[B]===l[0]){u=B,c[B]===t[i][0]&&u++;break}l[1]&&u++;for(B=u;B<c.length;++B)if(c[B]===b[0])p=B;else if(c[B]===t[i][1]){p=B;break}var D=p-u;b[1]&&D++;for(B=0;B<D;++B)-1===r.indexOf(c[u])?s.appendChild(c[u]):u++;e.push(h.insertBefore(s,c[u]))}}blitzphpDebugBar.createCookie("debug-view","show",365),blitzphpDebugBar.addClass(n,"active")}var n=document.querySelector("[data-tab=blitzphp-views]");n&&(n.parentNode.onclick=function(){blitzphpDebugBar.readCookie("debug-view")?function(){for(var t=0;t<e.length;++t){for(var a,r=0;r<e[t].parentNode.childNodes.length;++r)if(e[t].parentNode.childNodes[r]===e[t]){a=r;break}for(;1!==e[t].childNodes.length;)e[t].parentNode.insertBefore(e[t].childNodes[1],e[t].parentNode.childNodes[a].nextSibling),a++;e[t].parentNode.removeChild(e[t])}e.length=0,blitzphpDebugBar.createCookie("debug-view","",-1),blitzphpDebugBar.removeClass(n,"active")}():b()},blitzphpDebugBar.readCookie("debug-view")&&b())},setToolbarPosition:function(){var e=this.toolbar.querySelector("#toolbar-position");"top"===blitzphpDebugBar.readCookie("debug-bar-position")&&(blitzphpDebugBar.addClass(blitzphpDebugBar.icon,"fixed-top"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbar,"fixed-top")),e.addEventListener("click",(function(){var e=blitzphpDebugBar.readCookie("debug-bar-position");blitzphpDebugBar.createCookie("debug-bar-position","",-1),e&&"bottom"!==e?(blitzphpDebugBar.createCookie("debug-bar-position","bottom",365),blitzphpDebugBar.removeClass(blitzphpDebugBar.icon,"fixed-top"),blitzphpDebugBar.removeClass(blitzphpDebugBar.toolbar,"fixed-top")):(blitzphpDebugBar.createCookie("debug-bar-position","top",365),blitzphpDebugBar.addClass(blitzphpDebugBar.icon,"fixed-top"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbar,"fixed-top"))}),!0)},setToolbarTheme:function(){var e=this.toolbar.querySelector("#toolbar-theme");window.matchMedia("(prefers-color-scheme: dark)").matches,window.matchMedia("(prefers-color-scheme: light)").matches;"dark"===blitzphpDebugBar.readCookie("debug-bar-theme")?(blitzphpDebugBar.removeClass(blitzphpDebugBar.toolbarContainer,"light"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbarContainer,"dark")):"light"===blitzphpDebugBar.readCookie("debug-bar-theme")&&(blitzphpDebugBar.removeClass(blitzphpDebugBar.toolbarContainer,"dark"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbarContainer,"light")),e.addEventListener("click",(function(){var e=blitzphpDebugBar.readCookie("debug-bar-theme");!e&&window.matchMedia("(prefers-color-scheme: dark)").matches||"dark"===e?(blitzphpDebugBar.createCookie("debug-bar-theme","light",365),blitzphpDebugBar.removeClass(blitzphpDebugBar.toolbarContainer,"dark"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbarContainer,"light")):(blitzphpDebugBar.createCookie("debug-bar-theme","dark",365),blitzphpDebugBar.removeClass(blitzphpDebugBar.toolbarContainer,"light"),blitzphpDebugBar.addClass(blitzphpDebugBar.toolbarContainer,"dark"))}),!0)},setHotReloadState:function(){var e,t=document.getElementById("debug-hot-reload").parentNode,a=t.getElementsByTagName("img")[0];t&&(t.onclick=function(){blitzphpDebugBar.readCookie("debug-hot-reload")?(blitzphpDebugBar.createCookie("debug-hot-reload","",-1),blitzphpDebugBar.removeClass(t,"active"),blitzphpDebugBar.removeClass(a,"rotate"),void 0!==e&&(e.close(),e=void 0)):(blitzphpDebugBar.createCookie("debug-hot-reload","show",365),blitzphpDebugBar.addClass(t,"active"),blitzphpDebugBar.addClass(a,"rotate"),e=blitzphpDebugBar.hotReloadConnect())},blitzphpDebugBar.readCookie("debug-hot-reload")&&(blitzphpDebugBar.addClass(t,"active"),blitzphpDebugBar.addClass(a,"rotate"),e=blitzphpDebugBar.hotReloadConnect()))},hotReloadConnect:function(){const e=new EventSource(blitzSiteURL+"/__hot-reload");return e.addEventListener("reload",(function(e){window.location.reload()})),e.onerror=e=>{},e},createCookie:function(e,t,a){if(a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3);var i="; expires="+r.toGMTString()}else i="";document.cookie=e+"="+t+i+"; path=/; samesite=Lax"},readCookie:function(e){for(var t=e+"=",a=document.cookie.split(";"),r=0;r<a.length;r++){for(var i=a[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},trimSlash:function(e){return e.replace(/^\/|\/$/g,"")},routerLink:function(){for(var e,t,a=this.toolbar.querySelectorAll('td[data-debugbar-route="GET"]'),r=/\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\)/,i=0;i<a.length;i++)e=a[i],/\/\(.+?\)/.test(a[i].innerText)?e.innerHTML="<div>"+e.innerText+'</div><form data-debugbar-route-tpl="'+blitzphpDebugBar.trimSlash(e.innerText.replace(r,"?"))+'">'+e.innerText.replace(r,'<input type="text" placeholder="$1">')+'<input type="submit" value="Go" class="debug-bar-mleft4"></form>':(blitzphpDebugBar.addClass(e,"debug-bar-pointer"),e.setAttribute("title",location.origin+"/"+blitzphpDebugBar.trimSlash(e.innerText)),e.addEventListener("click",(function(e){t=location.origin+"/"+blitzphpDebugBar.trimSlash(e.target.innerText),window.open(t,"_blank").location})));a=this.toolbar.querySelectorAll('td[data-debugbar-route="GET"] form');for(i=0;i<a.length;i++)(e=a[i]).addEventListener("submit",(function(e){e.preventDefault();for(var a=[],r=0,i=e.target.querySelectorAll("input[type=text]"),l=e.target.getAttribute("data-debugbar-route-tpl"),o=0;o<i.length;o++)i[o].value.length>0&&a.push(i[o].value);a.length>0&&(t=location.origin+"/"+l.replace(/\?/g,(function(){return a[r++]})),window.open(t,"_blank").location)}))}};